(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tabBar/chat/chat"],{"0d09":function(t,e,s){},"5d90":function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i,a=n(s("fcfe"));function n(t){return t&&t.__esModule?t:{default:t}}function c(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var o={data:function(){var t;return t={myavatar:"",pavatar:"",pname:"",xuguanlist:[],selectedXG:"../../../static/daka.png",textMsg:"",isHistoryLoading:!1,scrollAnimation:!1,scrollTop:0,scrollToView:"",msgList:[],msgImgList:[],myuid:0,yuliao:[],popupLayerClass:"",hideMore:!0,hideEmoji:!0,uuid:"",isselecthabit:{}},c(t,"pname",""),c(t,"pavatar","../../static/touxiang/avatar.png"),c(t,"myname",""),c(t,"myavatar","../../static/touxiang/avatar.png"),t},onTabItemTap:function(t){this.getallstorage()},onReady:function(){this.getallstorage()},onLoad:function(t){i=this,this.getallstorage(),this.getMsgList(),this.xuguanlist=a.default.state.iconlib},onShow:function(){var e=this;this.scrollTop=9999999,this.getallstorage(),t.getStorage({key:"redEnvelopeData",success:function(s){var i=new Date,a=e.msgList[e.msgList.length-1].msg.id;a++;var n={type:"user",msg:{id:a,type:"redEnvelope",time:i.getHours()+":"+i.getMinutes(),userinfo:{uid:0,username:"大黑哥",face:"/static/img/face.jpg"},content:{blessing:s.data.blessing,rid:Math.floor(1e3*Math.random()+1),isReceived:!1}}};e.screenMsg(n),t.removeStorage({key:"redEnvelopeData"})}})},methods:{getallstorage:function(){var e=this;t.getStorage({key:"isselecthabit",success:function(t){e.isselecthabit=t.data}}),t.getStorage({key:"myname",success:function(t){e.myname=t.data}}),t.getStorage({key:"pname",success:function(t){e.pname=t.data},fail:function(t){e.pname="陪伴人"}}),t.getStorage({key:"myavatar",success:function(t){e.myavatar=t.data},fail:function(t){e.myavatar="../../../static/touxiang/avatar.png"}}),t.setStorage({key:"psex",data:this.psex}),t.setStorage({key:"pcallme",data:this.pcallme}),t.setStorage({key:"mysex",data:this.mysex}),t.setStorage({key:"myIdentity",data:this.myIdentity}),t.setStorage({key:"mybirthday",data:this.mybirthday}),t.getStorage({key:"pavatar",success:function(t){e.pavatar=t.data},fail:function(t){e.pavatar="../../../static/vippage/vipicon/heart.png"}}),t.getStorage({key:"uuid",success:function(t){e.uuid=t.data}})},screenMsg:function(t){if("system"==t.type)switch(t.msg.type){case"text":this.addSystemTextMsg(t);break;case"redEnvelope":this.addSystemRedEnvelopeMsg(t);break}else if("user"==t.type)switch(t.msg.type){case"text":this.addTextMsg(t);break;case"voice":this.addVoiceMsg(t);break;case"img":this.addImgMsg(t);break;case"redEnvelope":this.addRedEnvelopeMsg(t);break}this.$nextTick(function(){this.scrollToView="msg"+t.msg.id})},loadHistory:function(t){var e=this;if(!this.isHistoryLoading){this.isHistoryLoading=!0,this.scrollAnimation=!1;var s=this.msgList[0].msg.id;setTimeout(function(){e.$nextTick(function(){this.scrollToView="msg"+s,this.$nextTick(function(){this.scrollAnimation=!0})}),e.isHistoryLoading=!1},1e3)}},getMsgList:function(){for(var t=[{type:"user",msg:{id:1,type:"text",time:"12:56",userinfo:{uid:1,username:"大黑哥",face:"/static/img/face.jpg"},content:{text:this.myname+"你终于来了！木各习惯欢迎你!!我是"+this.pname}}},{type:"user",msg:{id:1,type:"text",time:"12:56",userinfo:{uid:1,username:"大黑哥",face:"/static/img/face.jpg"},content:{text:"期待跟你一起变成更优秀的人!哈哈哈!!"}}},{type:"user",msg:{id:1,type:"text",time:"12:56",userinfo:{uid:1,username:"大黑哥",face:"/static/img/face.jpg"},content:{text:"点击输入框选择你要打卡的习惯"}}},{type:"user",msg:{id:1,type:"text",time:"12:56",userinfo:{uid:1,username:"大黑哥",face:"/static/img/face.jpg"},content:{text:"点击+号可添加新的习惯"}}},{type:"user",msg:{id:1,type:"text",time:"12:56",userinfo:{uid:1,username:"大黑哥",face:"/static/img/face.jpg"},content:{text:"我会帮你记录你的习惯历程"}}},{type:"user",msg:{id:1,type:"text",time:"12:56",userinfo:{uid:1,username:"大黑哥",face:"/static/img/face.jpg"},content:{text:"我也会陪你一起完成你的习惯计划,记得常来看看我哦~"}}},{type:"user",msg:{id:1,type:"text",time:"12:56",userinfo:{uid:1,username:"大黑哥",face:"/static/img/face.jpg"},content:{text:"开始我们的旅程吧..."}}}],e=0;e<t.length;e++)"user"==t[e].type&&"img"==t[e].msg.type&&(t[e].msg.content=this.setPicSize(t[e].msg.content),this.msgImgList.push(t[e].msg.content.url));this.msgList=t,this.$nextTick(function(){this.scrollTop=9999,this.$nextTick(function(){this.scrollAnimation=!0})})},setPicSize:function(e){var s=t.upx2px(350),i=t.upx2px(350);if(e.w>s||e.h>i){var a=e.w/e.h;e.w=a>1?s:i*a,e.h=a>1?s/a:i}return e},showMore:function(){this.isVoice=!1,this.hideEmoji=!0,this.hideMore?(this.hideMore=!1,this.openDrawer()):this.hideDrawer()},openDrawer:function(){this.popupLayerClass="showLayer"},hideDrawer:function(){var t=this;this.popupLayerClass="",setTimeout(function(){t.hideMore=!0,t.hideEmoji=!0},150)},chooseImage:function(){this.getImage("album")},camera:function(){this.getImage("camera")},getImage:function(e){var s=this;this.hideDrawer(),t.chooseImage({sourceType:[e],sizeType:["original","compressed"],success:function(e){for(var i=function(i){t.getImageInfo({src:e.tempFilePaths[i],success:function(t){var a={url:e.tempFilePaths[i],w:t.width,h:t.height};s.sendMsg(a,"img")}})},a=0;a<e.tempFilePaths.length;a++)i(a)}})},chooseXG:function(){this.hideMore=!0,this.hideEmoji?(this.hideEmoji=!1,this.openDrawer()):this.hideDrawer()},addEmoji:function(t){this.textMsg+=t.alt},daka:function(t){this.textMsg="",this.textMsg+=t.iconname,this.selectedXG="../../../static/iconfont/"+t.url},delXG:function(e){var s=this;t.showModal({title:"删除习惯",content:"确定删除"+e.iconname+"?",success:function(i){i.confirm&&(t.showToast({icon:"success",title:"删除成功"}),s.isselecthabit[e.iconname]=!1,t.setStorage({key:"isselecthabit",data:s.isselecthabit}),t.request({url:"http://47.104.95.72:5000/usermanage",method:"POST",data:[s.uuid,s.isselecthabit,s.pname,s.psex,s.pcallme,s.pavatar,s.myname,s.mysex,s.myIdentity,s.mybirthday,s.myavatar]}))}})},clearInput:function(){this.textMsg="",this.selectedXG="../../../static/daka.png"},addxiguan:function(e){var s=this;t.showModal({title:"添加习惯",content:"确定添加"+e.iconname+"?",success:function(i){i.confirm&&(t.showToast({icon:"success",title:"添加成功"}),s.isselecthabit[e.iconname]=!0,t.setStorage({key:"isselecthabit",data:s.isselecthabit}),t.request({url:"http://47.104.95.72:5000/usermanage",method:"POST",data:[s.uuid,s.isselecthabit,s.pname,s.psex,s.pcallme,s.pavatar,s.myname,s.mysex,s.myIdentity,s.mybirthday,s.myavatar]}))}})},textareaFocus:function(){"showLayer"==this.popupLayerClass&&0==this.hideMore&&this.hideDrawer()},sendText:function(){if(this.hideDrawer(),this.textMsg){var t={text:this.textMsg};this.sendMsg(t,"text"),this.textMsg=""}},sendMsg:function(e,s){var a=this,n=new Date,c=n.getFullYear(),o=n.getMonth()+1,r=n.getDate();o<10&&(o="0"+o),r<10&&(r="0"+r);var u=c+"-"+o+"-"+r;t.request({url:"http://47.104.95.72:5000/yuliao",data:{date:u,iconname:i.textMsg,uuid:i.uuid},success:function(t){i.yuliao=t.data},fail:function(){},complete:function(){var t=i.yuliao,n=t[0],c=(a.textMsg,new Date),o=a.msgList[a.msgList.length-1].msg.id;o++;var r={type:"user",msg:{id:o,time:c.getHours()+":"+c.getMinutes(),type:s,userinfo:{uid:0,username:"大黑哥",face:"/static/img/face.jpg"},content:e}};a.screenMsg(r),setTimeout(function(){var e;o=a.msgList[a.msgList.length-1].msg.id,o++,"character"==t[1]&&(e="text",r={type:"user",msg:{id:o,time:c.getHours()+":"+c.getMinutes(),type:e,userinfo:{uid:1,username:"售后客服008",face:"/static/img/im/face/face_2.jpg"},content:{text:n}}}),"image"==t[1]&&(e="img",r={type:"user",msg:{id:o,time:c.getHours()+":"+c.getMinutes(),type:e,userinfo:{uid:1,username:"售后客服008",face:"/static/img/im/face/face_2.jpg"},content:{url:n}}}),a.screenMsg(r)},1e3)}})},addTextMsg:function(t){this.msgList.push(t)},addVoiceMsg:function(t){this.msgList.push(t)},addImgMsg:function(t){t.msg.content=this.setPicSize(t.msg.content),this.msgImgList.push(t.msg.content.url),this.msgList.push(t)},addRedEnvelopeMsg:function(t){this.msgList.push(t)},addSystemTextMsg:function(t){this.msgList.push(t)},addSystemRedEnvelopeMsg:function(t){this.msgList.push(t)},sendSystemMsg:function(t,e){var s=this.msgList[this.msgList.length-1].msg.id;s++;var i={type:"system",msg:{id:s,type:e,content:t}};this.screenMsg(i)},showPic:function(e){t.previewImage({indicator:"none",current:e.content.url,urls:this.msgImgList})},switchVoice:function(){this.hideDrawer(),this.isVoice=!this.isVoice},discard:function(){}}};e.default=o}).call(this,s("6e42")["default"])},"6eec":function(t,e,s){"use strict";s.r(e);var i=s("5d90"),a=s.n(i);for(var n in i)"default"!==n&&function(t){s.d(e,t,function(){return i[t]})}(n);e["default"]=a.a},"7a25":function(t,e,s){"use strict";s.r(e);var i=s("fcfc"),a=s("6eec");for(var n in a)"default"!==n&&function(t){s.d(e,t,function(){return a[t]})}(n);s("b1a2");var c=s("2877"),o=Object(c["a"])(a["default"],i["a"],i["b"],!1,null,null,null);e["default"]=o.exports},"8a32":function(t,e,s){"use strict";(function(t){s("9805"),s("921b");i(s("66fd"));var e=i(s("7a25"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,s("6e42")["createPage"])},b1a2:function(t,e,s){"use strict";var i=s("0d09"),a=s.n(i);a.a},fcfc:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement;t._self._c},a=[];s.d(e,"a",function(){return i}),s.d(e,"b",function(){return a})}},[["8a32","common/runtime","common/vendor"]]]);